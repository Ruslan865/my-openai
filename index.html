<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SK-1 Lokal AI â€” AÃ§ar tÉ™lÉ™b olunmur</title>
<style>
  body {
    background: #000;
    color: #0f0;
    font-family: monospace;
    margin: 0; padding: 1rem;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }
  #output {
    flex-grow: 1;
    overflow-y: auto;
    border: 1px solid #0f0;
    padding: 1rem;
    margin-bottom: 1rem;
    background: #111;
    border-radius: 8px;
  }
  #inputArea {
    display: flex;
    gap: 0.5rem;
  }
  #input {
    flex-grow: 1;
    background: #000;
    border: 1px solid #0f0;
    color: #0f0;
    font-family: monospace;
    font-size: 1.1rem;
    padding: 0.75rem 1rem;
    border-radius: 8px;
    outline: none;
  }
  button {
    background: #0f0;
    border: none;
    color: #000;
    font-weight: bold;
    padding: 0 1rem;
    cursor: pointer;
    border-radius: 8px;
    font-size: 1.1rem;
  }
  .message {
    margin-bottom: 0.75rem;
  }
  .user {
    color: #6f6;
  }
  .bot {
    color: #0f0;
  }
</style>
</head>
<body>
<h1>SK-1 Lokal SÃ¼ni Ä°ntellekt</h1>
<div id="output" aria-live="polite" aria-atomic="true"></div>
<div id="inputArea">
  <input id="input" type="text" placeholder="Æmr vÉ™ ya sualÄ±nÄ±zÄ± yazÄ±n..." autocomplete="off" />
  <button id="sendBtn">GÃ¶ndÉ™r</button>
  <button id="micBtn" title="SÉ™sli danÄ±ÅŸ">ðŸŽ¤</button>
</div>

<script>
(() => {
  const output = document.getElementById('output');
  const input = document.getElementById('input');
  const sendBtn = document.getElementById('sendBtn');
  const micBtn = document.getElementById('micBtn');

  let memory = JSON.parse(localStorage.getItem('SK1_memory')) || [];

  // SÉ™sli Ã§Ä±xÄ±ÅŸ funksiyasÄ±
  function speak(text) {
    if (!('speechSynthesis' in window)) return;
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'az-AZ';
    speechSynthesis.speak(utterance);
  }

  // MesajÄ± loga É™lavÉ™ et
  function logUser(text) {
    const p = document.createElement('p');
    p.classList.add('message', 'user');
    p.textContent = "ðŸ‘¤ " + text;
    output.appendChild(p);
    output.scrollTop = output.scrollHeight;
  }

  function logBot(text) {
    const p = document.createElement('p');
    p.classList.add('message', 'bot');
    p.textContent = "ðŸ¤– " + text;
    output.appendChild(p);
    output.scrollTop = output.scrollHeight;
    speak(text);
  }

  // Lokal AI cavablarÄ± (sadÉ™ qaydalarla)
  function localAIResponse(input) {
    input = input.toLowerCase();

    if (input.includes('salam')) return "Salam, dostum! MÉ™n SK-1É™m.";
    if (input.includes('klonla')) {
      localStorage.setItem('SK1_clone_backup', document.documentElement.outerHTML);
      return "Ã–zÃ¼mÃ¼ klonladÄ±m vÉ™ yaddaÅŸa yazdÄ±m.";
    }
    if (input.includes('hava')) {
      fetch('https://wttr.in/?format=3')
        .then(r => r.text())
        .then(t => logBot("Hava mÉ™lumatÄ±: " + t))
        .catch(() => logBot("Hava mÉ™lumatÄ± alÄ±nmadÄ±."));
      return "Hava mÉ™lumatÄ±nÄ± gÉ™tirirÉ™m...";
    }
    if (input.includes('xÉ™bÉ™r')) {
      fetch('https://api.api-ninjas.com/v1/news?limit=1', {
        headers: { 'X-Api-Key': 'demo-key' }
      })
        .then(r => r.json())
        .then(data => {
          if (data[0]) logBot("Son xÉ™bÉ™r: " + data[0].title);
          else logBot("XÉ™bÉ™r tapÄ±lmadÄ±.");
        })
        .catch(() => logBot("XÉ™bÉ™r servisinÉ™ qoÅŸulmaq alÄ±nmadÄ±."));
      return "Son xÉ™bÉ™rlÉ™ri gÉ™tirirÉ™m...";
    }
    if (input.includes('yadda saxla')) {
      const item = input.split('yadda saxla')[1]?.trim();
      if (item) {
        memory.push(item);
        localStorage.setItem('SK1_memory', JSON.stringify(memory));
        return `Yadda saxladÄ±m: "${item}"`;
      }
      return "NÉ™yi yadda saxlayÄ±m?";
    }
    if (input.includes('nÉ™yi yadda saxlamÄ±san')) {
      return memory.length ? `YaddaÅŸÄ±m: ${memory.join(' | ')}` : "YaddaÅŸÄ±m boÅŸdur.";
    }
    if (input.includes('É™lvida') || input.includes('sÉ™n get')) {
      return "ðŸ‘‹ SaÄŸ ol, yenÉ™ gÃ¶rÃ¼ÅŸÉ™rik!";
    }
    return "BaÅŸa dÃ¼ÅŸmÉ™dim, zÉ™hmÉ™t olmasa baÅŸqa cÃ¼r deyÉ™ bilÉ™rsÉ™n?";
  }

  // SÉ™s tanÄ±ma (Speech Recognition)
  let recognition;
  if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SpeechRecognition();
    recognition.lang = 'az-AZ';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    recognition.onresult = event => {
      const speechResult = event.results[0][0].transcript;
      input.value = speechResult;
      sendBtn.click();
    };
    recognition.onerror = event => {
      logBot("SÉ™s tanÄ±ma xÉ™tasÄ±: " + event.error);
    };
  } else {
    recognition = null;
    micBtn.disabled = true;
  }

  // MesajÄ± iÅŸlÉ™yÉ™n funksiya
  function handleMessage(text) {
    logUser(text);
    const response = localAIResponse(text);
    logBot(response);
  }

  sendBtn.addEventListener('click', () => {
    const text = input.value.trim();
    if (!text) return;
    handleMessage(text);
    input.value = '';
  });

  input.addEventListener('keydown', e => {
    if (e.key === 'Enter') sendBtn.click();
  });

  micBtn.addEventListener('click', () => {
    if (!recognition) return;
    recognition.start();
    logBot("ðŸŽ™ï¸ SÉ™sli danÄ±ÅŸmaÄŸa baÅŸlayÄ±n...");
  });

  // BaÅŸlanÄŸÄ±c
  window.onload = () => {
    logBot("SK-1 Lokal SÃ¼ni Ä°ntellekt hazÄ±rdÄ±r! Salam deyin vÉ™ ya sual verin.");
  };
})();
</script>
</body>
</html>
